import proguard.gradle.ProGuardTask

/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/5.0/userguide/tutorial_java_projects.html
 */


buildscript {
    repositories {
        jcenter()
        mavenCentral()
        mavenLocal()
    }
   	dependencies {
        // provides javafx-gradle-plugin
       // classpath group: 'de.dynamicfiles.projects.gradle.plugins', name: 'javafx-gradle-plugin', version: "8.8.2"
        // provides proguard.gradle.ProGuardTask (including all requirements)
        classpath 'com.guardsquare:proguard-gradle:7.1.0'
    }
}


plugins {
    // Apply the java plugin to add support for Java
    id 'java'
    id 'io.freefair.lombok' version "8.0.1"
    id 'com.github.johnrengelman.shadow' version '8.1.1'
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

repositories {
    // Use jcenter for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.

    jcenter()
    mavenCentral()
    mavenLocal()

    //maven { url 'http://repo.runelite.net', allowInsecureProtocol = true }
    //maven { url 'https://jitpack.io', allowInsecureProtocol = true
}

/*lombok { // optional: values below are the defaults
    version = "6.6.3"
    sha256 = ""
}*/

dependencies {
    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.9.2'
    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.9.2'

    implementation 'io.freefair.lombok:io.freefair.lombok.gradle.plugin:6.6.3'
    implementation 'net.sf.proguard:proguard-gradle:6.2.2'

    implementation group: 'org.slf4j', name:'slf4j-api', version: '2.0.5'
    implementation group: 'com.google.guava', name: 'guava', version: '31.1-jre'
    implementation group: 'ch.qos.logback', name: 'logback-classic', version: '1.4.6'
    implementation group: 'commons-io', name: 'commons-io', version: '2.11.0'
    implementation group: 'org.apache.commons', name: 'commons-lang3', version: '3.12.0'
    implementation group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: '2.14.2'
    implementation group: 'com.dorkbox', name: 'Notify', version: '3.7' // Desktop notifications
    implementation group: 'com.google.code.gson', name: 'gson', version: '2.10.1'

    // https://github.com/aschoerk/reflections8
    implementation group: 'net.oneandone.reflections8', name: 'reflections8', version: '0.11.7'


    // Jackson
    implementation 'com.fasterxml.jackson.core:jackson-core:2.14.2'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.14.2'
    implementation 'com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.14.2'

    // Discord rich presence
    //implementation 'com.github.Vatuu:discord-rpc:1.6.2'

//    // Runelite dependencies below
//    implementation group: 'net.runelite.pushingpixels', name: 'trident', version: '1.5.00'
//    implementation group: 'net.runelite.pushingpixels', name: 'substance', version: '8.0.02'
//    compileOnly group: 'org.projectlombok', name: 'lombok', version: '1.18.4'
//    implementation group: 'com.google.inject', name: 'guice', version: '4.2.2'
//    implementation group: 'com.google.code.findbugs', name: 'jsr305', version: '3.0.2'
//    implementation group: 'com.squareup.okhttp3', name: 'okhttp', version: '4.3.0'
//   // implementation group: 'com.google.collections', name: 'google-collections', version: '1.0'

//    implementation group: 'org.apache.commons', name: 'commons-csv', version: '1.7'
//    implementation group: 'org.apache.commons', name: 'commons-text', version: '1.8'
//    implementation group: 'net.sf.jopt-simple', name: 'jopt-simple', version: '5.0.4'
//    implementation group: 'com.massisframework', name: 'orange-extensions', version: '1.3.1'
//    implementation "net.runelite:discord:1.1"

    // Attempt to fix error found in user's error logback
    // java.lang.NoClassDefFoundError: Could not initialize class java.awt.event.MouseEventjava.lang.NoClassDefFoundError: Could not initialize class java.awt.event.MouseEvent
    implementation group: 'com.intellij', name: 'forms_rt', version: '7.0.3'
}

jar {
    manifest {
        attributes(
                'Main-Class': 'com.client.Client',
                'Implementation-Version': version
        )

        from('src/main/resources/META-INF/MANIFEST.MF')
    }
    //exclude 'META-INF/*.SF', 'META-INF/*.DSA', 'META-INF/*.RSA'

    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

sourceSets {
    main {
        java {
            srcDir 'src/main/java'
//            srcDir 'runelite/http-api/src/main/java'
//            srcDir 'runelite/runelite-api/src/main/java'
//            srcDir 'runelite/runelite-client/src/main/java'
        }
        resources {
            srcDir 'src/main/resources'
//            srcDir 'runelite/http-api/src/main/resources'
//            srcDir 'runelite/runelite-client/src/main/resources'
        }
    }
    test {
        java {
            srcDir 'src/test/java'
        }
    }
}

/*tasks {
    "build" {
        dependsOn(shadowJar)
    }

    shadowJar {
        mergeServiceFiles {
            var path = "src/main/resources/META-INF/"
        }

        //manifest.inheritFrom(jar.get().manifest)
        manifest.attributes["Main-Class"] = "com.client.Client"
        manifest.attributes["Implementation-Version"] = version

    }
}*/

tasks.withType(Copy).configureEach { duplicatesStrategy 'exclude' }


tasks.register('createStandardJar', Jar) {
    from(sourceSets.main.output) {
        duplicatesStrategy = DuplicatesStrategy.EXCLUDE

        //archiveFileName = "NotObfuscatedClient.jar"
        manifest {
            attributes(
                    'Manifest-Version': '1.0',
                    'Main-Class': 'com.client.Client'
            )
        }
        from configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it).matching { exclude { it.name.contains('MANIFEST.MF') } } }
    }
}

/*task createRuneliteJar(type: Jar) {
    from (sourceSets.main.output) {
        archiveFileName = "NotObfuscatedRunelite.jar"
        manifest {
            attributes(
                    'Main-Class': 'net.runelite.client.RuneLite',
            )
        }
        from configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it).matching{ exclude{it.name.contains('MANIFEST.MF') } } }
    }
}*/

/*tasks.register('proguard', ProGuardTask) {
    configuration file('proguard.pro')

    injars(tasks.named('jar', Jar).flatMap { it.archiveFile })

    // Automatically handle the Java version of this build.
    if (System.getProperty('java.version').startsWith('1.')) {
        // Before Java 9, the runtime classes were packaged in a single jar file.
        libraryjars "${System.getProperty('java.home')}/lib/rt.jar"
    } else {
        // As of Java 9, the runtime classes are packaged in modular jmod files.
        libraryjars "${System.getProperty('java.home')}/jmods/java.base.jmod", jarfilter: '!**.jar', filter: '!module-info.class'
        //libraryjars "${System.getProperty('java.home')}/jmods/....."
    }

    verbose

    outjars(layout.buildDirectory.file("libs/${baseCoordinates}-minified.jar"))
}*/

/*task obfuscateStandard(type: ProGuardTask) {
    //duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    configuration 'proguard.conf'

    configurations.runtimeClasspath.resolve().each {
        libraryjars file(it.getAbsolutePath())
    }

    injars 'build/libs/NotObfuscatedClient.jar'
    outjars 'build/libs/deploy/ObfuscatedClient.jar'
}*/

/*task obfuscateRunelite(type: ProGuardTask) {
    configuration 'proguard.conf'

    configurations.runtimeClasspath.resolve().each {
        libraryjars file(it.getAbsolutePath())
    }

    injars 'build/libs/NotObfuscatedRunelite.jar'
    outjars 'build/libs/deploy/ObfuscatedRunelite.jar'
}*/

/*task buildJars {
    dependsOn 'createStandardJar'
    //dependsOn 'createRuneliteJar'
    //dependsOn 'obfuscateStandard'
    //dependsOn 'obfuscateRunelite'
}*/



